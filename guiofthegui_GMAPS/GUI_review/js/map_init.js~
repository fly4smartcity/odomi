	var Vlayer=new Array();//vettore di layer di punti
//coordinate gps del target da inviare
var targetLat;
var targetLng;
var multiLat = new Array();
var multiLng = new Array();
var ix = 0;
//
	

	var map = L.map('map').setView([45.06, 7.65], 13);//ISTANZIA LA MAPPA CON GPS E ZOOM

	//L.tileLayer(CM_URL, {attribution: CM_ATTR, styleId: 997}).addTo(map);//da lo sfondo
	L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
			maxZoom: 18,
			attribution: 'Map data &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors, ' +
				'<a href="http://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
				'Imagery Â© <a href="http://mapbox.com">Mapbox</a>',
			id: 'examples.map-9ijuk24y'
		}).addTo(map);
	/*L.marker([45.06581, 7.65914]).addTo(map)
		.bindPopup("<b>Hello world!</b><br >I am a popup.").openPopup();*/
/***********************
definizione del cerchio : centroGPS,raggio,stile
************************/
/*
	L.circle([45.07, 7.68], 500, {
		color: 'red',
		fillColor: '#f03',
		fillOpacity: 0.5
	}).addTo(map).bindPopup("I am a circle.");
*/
/**************************
definizione del poligono dando i valori in senzo orario
**************************/
/*
	L.polygon([
		[45.06, 7.64],
		[45.06, 7.62],
		[45.07, 7.62],
		[45.07, 7.64]
	]).addTo(map).bindPopup("I am a polygon.");
*/
	
	/*var popup = L.popup();
	var i=0;*/




	
	function onMarkClick(e){//se viene click un marker viene richiamata questa funzione che permette di elaborarlo in funzione di cosa si sta' facendo		
		var gps=e.latlng.toString();
		if (creaPercorso==true)	//se sono in modalita' crea percorso
		{
			//alert("id e' "+getIdMarker(e.latlng.toString()));
			map.removeLayer(Vlayer[getIdMarker(gps,Vlayer)]);//elimino il marker dalla mappa
			//alert("eliminato");
			eliminaDatoID(getIdMarker(gps,Vlayer),Vlayer);//elimino il marker dal vettore
			//il refresh dei punti viene in automatico		
		}
	}
	function onMapClick(e,markerArray,maxLenght,lenght) 		{		
		var gpsClick=e.latlng.toString();
		var i;
		//alert(creaPercorso+" "+gpsClick+" "+Vlayer.length);
		if (creaPercorso==true)	//se sono in modalita' crea percorso
		{	
			i=Vlayer.length;
			//alert(i);
			Vlayer[i]= new L.marker([getlat(gpsClick), getlng(gpsClick)]).on('click',onMarkClick);//inserisco il punto nel vettore
			map.addLayer(Vlayer[i]);//lo disegno sulla mappa
			//}
		}
		else if(scegliTarget==true)
		{
			targetLat=getlat(gpsClick);
			targetLng=getlng(gpsClick);

			//vettore targetlat, targetLng

			//targetLat =
			
			map.removeLayer(goal);
			map.addLayer(goal);
			//al click cambio le coordinate del goal
			var newLatLngMrk= new L.LatLng(targetLat, targetLng);//istanzio le nuove coordinate
			goal.setLatLng(newLatLngMrk);//applico le nuove coordinate
			$('#btnGoMission').prop('disabled', false);	
		}
		
		else if(scegliMoltiTarget==true)
		{
			i=Vlayer.length;
			
			Vlayer[i]= new L.marker([getlat(gpsClick), getlng(gpsClick)]).on('click',onMarkClick);//inserisco il punto nel vettore
			map.addLayer(Vlayer[i]);//lo disegno sulla mappa

			//estraggo il path GPS dai marker
			p=getPathdatoLayer(Vlayer);//estraggo il path GPS dai marker

			n=p.length;

			//riempo il vettore
			multiLat[ix]=getlat(gpsClick);
			multiLng[ix]=getlng(gpsClick);
			ix = ix + 1; //sposto l'indice

			if(ix == 3)alert("finisch %f", multiLat[1] );
			$('#btnGoMission').prop('disabled', false);


			
		}		
		


/*popup
			.setLatLng(e.latlng)
			.setContent("You clicked the map at " + e.latlng.toString())
			.openOn(map);*/
		/*var gpsClick=e.latlng.toString()
		//alert( gps );
		i++;*/
		//alert(/*getlng*/(e.latlng.toString()));
/*
		L.marker([getlat(gps), getlng(gps)]).addTo(map)*/
		/*.bindPopup("<b>Hello world!</b><br >I am a popup number"+i+"!.").openPopup()*/;
	}
	

/*************************
evento on click
**************************/
	map.on('click', onMapClick);




//marker con font awesome per la home, destinazione e drone
var homeMarker = L.AwesomeMarkers.icon({
    icon: 'home',
    markerColor: 'darkpurple',
    prefix: 'fa'
  });
var goalMarker = L.AwesomeMarkers.icon({
    icon: 'flag-checkered ',
    markerColor: 'green',
    prefix: 'fa'
  });
var droneMarker = L.AwesomeMarkers.icon({
    icon: 'plane',
    markerColor: 'red',
    prefix: 'fa'
  });
//
//L.marker([45.07, 7.66], {icon: redMarker}).addTo(map);
//ISTANZIO LA HOME E IL DRONE
//ZIndexOffset mette il numero del livello del layer a cui si riferisce il marker
	var home=new L.marker([45.06, 7.65], {icon: homeMarker}).bindPopup("I am Home").setZIndexOffset(1);//.addTo(map)
	var drone=new L.marker([45.07, 7.66], {icon: droneMarker}).bindPopup("I am a DRONE.").setZIndexOffset(2);//.addTo(map)
	var goal=new L.marker([45.08, 7.67], {icon: goalMarker}).bindPopup("I am the GOAL.").setZIndexOffset(1);
	//map.addLayer(home);//i mrk vanno aggiunti come layer cosi' da poi essere cambiati
	//map.addLayer(drone);
	//map.addLayer(goal);

//<prova
//map.addLayer(drone);
//alert("doppio rwemove");
//map.removeLayer(drone);
//map.removeLayer(drone);
	//alert("show");
	//map.removeLayer(drone);
	//alert("hide");
//    	map.addLayer(drone);
//>


	//alert("ora sposto il drone");//home.getLatLng());//da lat e lng di un marker
	/*var newLatLngMrk= new L.LatLng(45.00, 7.60);//istanzio le nuove coordinate
		drone.setLatLng(newLatLngMrk);//applico le nuove coordinate*/
	//updateMarker(drone,'45.00','7.60');



//cambiare icone dei marker
//http://leafletjs.com/examples/custom-icons.html
/*
var greenIcon = L.icon({
    iconUrl: 'leaf-green.png',
    shadowUrl: 'leaf-shadow.png',

    iconSize:     [38, 95], // size of the icon
    shadowSize:   [50, 64], // size of the shadow
    iconAnchor:   [22, 94], // point of the icon which will correspond to marker's location
    shadowAnchor: [4, 62],  // the same for the shadow
    popupAnchor:  [-3, -76] // point from which the popup should open relative to the iconAnchor
});

L.marker([51.5, -0.09], {icon: greenIcon}).addTo(map);
*/

$('#btnHome').prop('disabled', true);
$('#btnGoMission').prop('disabled', true);
$('#btnPause').prop('disabled', true);
$('#btnSwitch1').prop('disabled', true);
$('#btnSwitch2').prop('disabled', true);
$('#btnSwitch3').prop('disabled', true);
